sudo: required

dist: xenial
language: python

python:
  - "3.7"

services:
  - docker

install:
  - pip install -r requirements.txt
  - pip install -r deploy-requirements.txt

env:
  global:
    - IMAGE_NAME=chud0/is_workday

script:
  - make test

before_deploy:
  - python swagger_to_html.py < openapi.yaml > data/doc.html
  - docker build -t $IMAGE_NAME .
  - docker tag $IMAGE_NAME $IMAGE_NAME:latest
  - docker tag $IMAGE_NAME $IMAGE_NAME:$TRAVIS_COMMIT
  - docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD

deploy:
  provider: script
  script: bash docker_push
  on:
    branch: master
